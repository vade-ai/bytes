<div class="sidebar-right">
  <!-- Sign-in CTA -->
  <div class="signin-cta">
    <h4>Sign in to Vade Bytes</h4>
    <p>Track your learning progress across devices with spaced repetition</p>
    <a href="#" class="btn" id="signin-btn">Sign In</a>
  </div>

  <!-- Spaced Repetition Progress -->
  <div class="sr-progress" id="sr-progress" style="display: none;">
    <h4>Your Learning Progress</h4>
    <div class="sr-timeline">
      <div class="sr-level">
        <span class="sr-level-label">Long-term</span>
        <span class="sr-level-count">0</span>
      </div>
      <div class="sr-level">
        <span class="sr-level-label">3 months</span>
        <span class="sr-level-count">0</span>
      </div>
      <div class="sr-level">
        <span class="sr-level-label">3 weeks</span>
        <span class="sr-level-count">0</span>
      </div>
      <div class="sr-level">
        <span class="sr-level-label">1 week</span>
        <span class="sr-level-count">0</span>
      </div>
      <div class="sr-level">
        <span class="sr-level-label">In-text</span>
        <span class="sr-level-count">0</span>
      </div>
    </div>
  </div>

  <!-- Table of Contents (for current post) -->
  <div class="toc-section" id="toc-section">
    <!-- TOC will be auto-generated by Quarto -->
  </div>

  <!-- Newsletter Signup -->
  <div class="newsletter-signup">
    <h4>Newsletter</h4>
    <p>Get weekly insights on AI, data, and systems engineering</p>
    <form id="newsletter-form">
      <input
        type="email"
        name="email"
        placeholder="your@email.com"
        required
        aria-label="Email address"
      />
      <button type="submit">Subscribe</button>
    </form>
    <div id="newsletter-message" style="margin-top: 0.5rem; font-size: 0.85rem;"></div>
  </div>

  <!-- Related Links -->
  <div class="related-links" id="related-links">
    <!-- Dynamically populated based on post tags/categories -->
  </div>

  <!-- Support CTA -->
  <div class="support-cta">
    <h5>Support Us</h5>
    <p>Our projects are funded by readers like you.</p>
    <a href="https://patreon.com/vade" target="_blank" rel="noopener">Support on Patreon</a>
  </div>
</div>

<script>
  // Newsletter form handling
  document.getElementById('newsletter-form')?.addEventListener('submit', async function(e) {
    e.preventDefault();
    const form = e.target;
    const email = form.email.value;
    const messageDiv = document.getElementById('newsletter-message');

    try {
      // TODO: Replace with actual API endpoint
      // For now, just show success message
      messageDiv.textContent = 'Thank you for subscribing!';
      messageDiv.style.color = 'var(--bs-success)';
      form.reset();

      // In production, you'd call your newsletter API:
      // const response = await fetch('/api/newsletter/subscribe', {
      //   method: 'POST',
      //   headers: { 'Content-Type': 'application/json' },
      //   body: JSON.stringify({ email })
      // });
      // const data = await response.json();
    } catch (error) {
      messageDiv.textContent = 'Something went wrong. Please try again.';
      messageDiv.style.color = 'var(--bs-danger)';
    }
  });

  // Sign-in button handling
  document.getElementById('signin-btn')?.addEventListener('click', function(e) {
    e.preventDefault();
    // TODO: Implement authentication flow
    alert('Sign-in functionality coming soon!');
  });

  // Load SR progress if user is signed in
  function loadSRProgress() {
    // Check if user is signed in
    const userSignedIn = localStorage.getItem('vade_bytes_user_token');
    if (userSignedIn) {
      document.getElementById('sr-progress').style.display = 'block';
      // Load actual progress data
      // TODO: Fetch from API
    }
  }

  // Load related links based on current post
  function loadRelatedLinks() {
    // TODO: Implement based on post metadata
    // For now, show some static examples
    const relatedLinksHtml = `
      <h4>Related Topics</h4>
      <ul>
        <li><a href="#">Getting Started with Clojure</a></li>
        <li><a href="#">Data Visualization Basics</a></li>
        <li><a href="#">Spaced Repetition Systems</a></li>
      </ul>
    `;
    const relatedDiv = document.getElementById('related-links');
    if (relatedDiv) {
      relatedDiv.innerHTML = relatedLinksHtml;
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    loadSRProgress();
    loadRelatedLinks();
  });
</script>
